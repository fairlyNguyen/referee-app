<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Referee Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      padding: 20px;
    }
    h2 { text-align: center; color: #333; }
    .card {
      max-width: 500px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .input-row {
      display: flex;
      margin-bottom: 12px;
    }
    .input-row input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .input-row button {
      margin-left: 8px;
      padding: 8px 12px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    /* Court layout */
    .court {
      position: relative;
      width: 100%;
      height: 250px;
      margin: 20px 0;
      background: #c8e6c9;
      border: 3px solid #2e7d32;
      border-radius: 10px;
    }
    .court-line {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 2px;
      background: #2e7d32;
    }
    .court-vertical {
      position: absolute;
      top: 0;
      left: 50%;
      width: 2px;
      height: 100%;
      background: #2e7d32;
    }
    .player {
      position: absolute;
      width: 100px;
      padding: 6px;
      text-align: center;
      background: rgba(255,255,255,0.9);
      border-radius: 8px;
      font-weight: bold;
      font-size: 14px;
    }
    /* Home team positions */
    .home.top-left { top: 20px; left: 20px; }
    .home.bottom-left { bottom: 20px; left: 20px; }
    /* Away team positions */
    .away.top-right { top: 20px; right: 20px; }
    .away.bottom-right { bottom: 20px; right: 20px; }

    /* Score controls */
    .score-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
    }
    .home { background: #e3f2fd; }
    .away { background: #fce4ec; }
    .score-controls {
      display: flex;
      align-items: center;
    }
    .score-controls button {
      width: 32px; height: 32px;
      font-size: 18px;
      border: none;
      border-radius: 50%;
      margin: 0 5px;
      cursor: pointer;
      background: #ddd;
    }
    .score-controls input {
      width: 50px;
      text-align: center;
      font-size: 16px;
      padding: 5px;
    }
    .actions {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }
    .actions button {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    #updateBtn { background: #28a745; color: white; }
    #doneBtn { background: #dc3545; color: white; }
  </style>
</head>
<body>
  <h2>üèì Referee Panel</h2>

  <div class="card">
    <!-- Tournament ID -->
    <div class="input-row">
      <input type="text" id="tourInput" placeholder="Enter Tournament ID">
    </div>

    <!-- Match ID -->
    <div class="input-row">
      <input type="text" id="matchInput" placeholder="Enter Match ID">
      <button id="findBtn">Find</button>
    </div>

    <!-- Match Info -->
    <div id="matchArea">
      <p><strong>Match:</strong> <span id="matchId">---</span></p>

      <!-- Court -->
      <div class="court">
        <div class="court-line"></div>
        <div class="court-vertical"></div>
        <div class="player home top-left" id="homePlayer1">Home --</div>
        <div class="player home bottom-left" id="homePlayer2">Home --</div>
        <div class="player away top-right" id="awayPlayer1">Away --</div>
        <div class="player away bottom-right" id="awayPlayer2">Away --</div>
      </div>

      <div class="score-box home">
        <strong>Home:</strong> <span id="homeName">--</span>
        <div class="score-controls">
          <button onclick="changeScore('home', -1)">-</button>
          <input type="number" id="homeScore" min="0" max="11" value="0">
          <button onclick="changeScore('home', 1)">+</button>
        </div>
      </div>

      <div class="score-box away">
        <strong>Away:</strong> <span id="awayName">--</span>
        <div class="score-controls">
          <button onclick="changeScore('away', -1)">-</button>
          <input type="number" id="awayScore" min="0" max="11" value="0">
          <button onclick="changeScore('away', 1)">+</button>
        </div>
      </div>

      <div class="actions">
        <button id="updateBtn">‚úÖ Update Score</button>
        <button id="doneBtn">üèÅ Set Done</button>
      </div>
    </div>
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  console.log("‚úÖ JS Loaded");

  // ‚ö†Ô∏è replace with your real Firebase config from console
  const firebaseConfig = {
    apiKey: "AIzaSyD6tKItFtCJDYDxSLClLjJDqdR0scsU4kg",
    authDomain: "fir-demo-a1c99.firebaseapp.com",
    databaseURL: "https://fir-demo-a1c99.firebaseio.com",
    projectId: "fir-demo-a1c99",
    storageBucket: "fir-demo-a1c99.firebasestorage.app",
    messagingSenderId: "980490887183",
    appId: "1:980490887183:web:ef665624ab306006d7037a",
    measurementId: "G-TR0CCTRTGJ"
  };

   let app, db;
  try {
    app = initializeApp(firebaseConfig);
    db = getDatabase(app);
    console.log("‚úÖ Firebase initialized");
  } catch (e) {
    console.error("‚ùå Firebase init error:", e);
    alert("Firebase config error! Check console.");
  }

  let currentMatchId = null;
  let currentTourId = null;

  // -------- SCORE CHANGER (used by + / - buttons) ----------
  window.changeScore = function (team, delta) {
    const input = document.getElementById(team + "Score");
    let val = parseInt(input.value || "0", 10);
    val = Math.max(0, val + delta);
    input.value = val;
  };

  // -------- FIND BUTTON ----------
  document.getElementById("findBtn")?.addEventListener("click", async () => {
    console.log("üîç Find button clicked");
    try {
      const matchId = document.getElementById("matchInput").value.trim();
      const tourId = document.getElementById("tourInput").value.trim();

      if (!tourId) return alert("Enter a Tournament ID!");
      if (!matchId) return alert("Enter a Match ID!");

      const path = `tournaments/${tourId}/matches/${matchId}`;
      console.log("üìÇ Fetching path:", path);

      const matchRef = ref(db, path);
      const snapshot = await get(matchRef);

      if (snapshot.exists()) {
        const data = snapshot.val();
        console.log("‚úÖ Data found:", data);

        currentMatchId = matchId;
        currentTourId = tourId;

        document.getElementById("matchId").textContent = matchId;
        document.getElementById("homeName").textContent = data.home || "--";
        document.getElementById("awayName").textContent = data.away || "--";
        document.getElementById("homeScore").value = data.homeScore ?? 0;
        document.getElementById("awayScore").value = data.awayScore ?? 0;

        const homePlayers = (data.home || "Home1-Home2").split("-");
        const awayPlayers = (data.away || "Away1-Away2").split("-");

        document.getElementById("homePlayer1").textContent = homePlayers[0] || "Home --";
        document.getElementById("homePlayer2").textContent = homePlayers[1] || "Home --";
        document.getElementById("awayPlayer1").textContent = awayPlayers[0] || "Away --";
        document.getElementById("awayPlayer2").textContent = awayPlayers[1] || "Away --";
      } else {
        console.warn("‚ö†Ô∏è Match not found at:", path);
        alert("Match not found!");
      }
    } catch (err) {
      console.error("‚ùå Find error:", err);
      alert("Error: " + err.message);
    }
  });

  // -------- UPDATE SCORE BUTTON ----------
  document.getElementById("updateBtn")?.addEventListener("click", async () => {
    console.log("üíæ Update button clicked");
    if (!currentMatchId || !currentTourId) {
      alert("‚ö†Ô∏è Load a match first using Find!");
      return;
    }

    try {
      const homeScore = parseInt(document.getElementById("homeScore").value, 10) || 0;
      const awayScore = parseInt(document.getElementById("awayScore").value, 10) || 0;
      const path = `tournaments/${currentTourId}/matches/${currentMatchId}`;
      await update(ref(db, path), { homeScore, awayScore, state: "ONGOING" });
    } catch (err) {
      console.error("‚ùå Update error:", err);
      alert("Update failed: " + err.message);
    }
  });

  // -------- SET DONE BUTTON ----------
  document.getElementById("doneBtn")?.addEventListener("click", async () => {
    console.log("üèÅ Done button clicked");
    if (!currentMatchId || !currentTourId) {
      alert("‚ö†Ô∏è Load a match first using Find!");
      return;
    }

    try {
      const path = `tournaments/${currentTourId}/matches/${currentMatchId}`;
      await update(ref(db, path), { state: "FINISHED" });
      alert("üèÅ Match marked as Done!");
    } catch (err) {
      console.error("‚ùå Done error:", err);
      alert("Failed to mark done: " + err.message);
    }
  });
</script>
</body>
</html>
